<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VZT Ecossistema | Master Full Integrated</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        vzt: {
                            black: '#09090b',    
                            sidebarHover: '#27272a', 
                            primary: '#2563eb',  
                            border: '#e2e8f0'    
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Anima√ß√µes */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Navega√ß√£o Ativa */
        .nav-active {
            background-color: #27272a;
            color: #ffffff;
            border-left: 3px solid #3b82f6;
        }

        /* Checkbox Riscado */
        .task-checkbox:checked + div {
            text-decoration: line-through;
            color: #94a3b8;
        }
        
        /* Colunas do Kanban */
        .kanban-col { min-width: 320px; }
        .kanban-card { transition: all 0.2s; }
        .kanban-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Gr√°fico CSS Puro (Marketing) - Essencial para o visual antigo */
        .bar-container { position: relative; height: 100%; border-radius: 4px 4px 0 0; transition: height 0.5s ease; }
        
        /* Modo Login (Tela Cheia) */
        body.login-mode { overflow: hidden; background-color: #f8fafc; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyAfbaZl283P9mcdo8Y1_-TQV4rO6jBr1pA",
            authDomain: "vzt-ecossistema.firebaseapp.com",
            projectId: "vzt-ecossistema",
            storageBucket: "vzt-ecossistema.firebasestorage.app",
            messagingSenderId: "108606764562",
            appId: "1:108606764562:web:5056575809af5146814acb",
            measurementId: "G-VQP7YRJMCM"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        window.vztAuth = auth;
        window.vztDb = db;

        // --- LISTA DE ACESSO (Seguran√ßa) ---
        const ALLOWED_USERS = [
            "ingrid@leiriaconsulting.com",
            "drvizzotto@vizzotto.com.br"
        ];

        // --- LOGIN LOGIC ---
        window.handleLogin = async () => {
            const btn = document.getElementById('btn-login-google');
            const errorMsg = document.getElementById('login-error-msg');
            
            try {
                btn.innerHTML = 'Verificando credenciais...';
                const result = await signInWithPopup(auth, provider);
                const userEmail = result.user.email;

                if (!ALLOWED_USERS.includes(userEmail)) {
                    await signOut(auth);
                    errorMsg.innerText = `Acesso negado para: ${userEmail}.`;
                    errorMsg.classList.remove('hidden');
                    btn.innerHTML = 'Tentar Outra Conta';
                }
            } catch (error) {
                console.error(error);
                btn.innerHTML = 'Erro no Login. Tente novamente.';
            }
        }

        window.handleLogout = () => {
            signOut(auth).then(() => window.location.reload());
        }

        // --- DADOS COMPARTILHADOS (CL√çNICA) ---
        const CLINIC_ID = "MATRIZ_PRINCIPAL"; 

        window.loadChatHistory = function() {
            const chatContainer = document.getElementById('chat-messages-area');
            if(!auth.currentUser || !chatContainer) return;
            
            const q = query(collection(db, "clinics", CLINIC_ID, "chat_logs"), orderBy("timestamp", "asc"));
            
            onSnapshot(q, (snapshot) => {
                chatContainer.innerHTML = ''; 
                snapshot.forEach((doc) => {
                    const msg = doc.data();
                    appendMessageToUI(msg.text, msg.sender, msg.userName);
                });
                chatContainer.scrollTop = chatContainer.scrollHeight;
            });
        }

        window.sendToCloud = async function() {
            const input = document.getElementById('chat-input');
            const contextSelect = document.getElementById('chat-context-select');
            const context = contextSelect ? contextSelect.value : "Geral";

            const text = input.value;
            if(!text || !auth.currentUser) return;
            input.value = ''; 
            
            await addDoc(collection(db, "clinics", CLINIC_ID, "chat_logs"), {
                text: text, 
                context: context,
                sender: 'user', 
                userName: auth.currentUser.displayName.split(' ')[0],
                timestamp: new Date()
            });
            
            setTimeout(async () => {
                await addDoc(collection(db, "clinics", CLINIC_ID, "chat_logs"), {
                    text: `Recebido. Vinculado a pasta: **${context}** (Drive).`, sender: 'ai', timestamp: new Date()
                });
            }, 1000);
        }

        function appendMessageToUI(text, sender, userName) {
            const container = document.getElementById('chat-messages-area');
            if(!container) return;
            let html = '';
            if (sender === 'user') {
                const isMe = userName === auth.currentUser.displayName.split(' ')[0];
                html = `<div class="flex flex-col ${isMe ? 'items-end' : 'items-start'} mb-4"><span class="text-[10px] text-slate-400 mb-1 px-1">${isMe ? 'Voc√™' : userName}</span><div class="${isMe ? 'bg-slate-900 text-white rounded-tr-xl' : 'bg-slate-200 text-slate-700 rounded-tl-xl'} p-3 rounded-lg rounded-b-xl text-sm max-w-md shadow-sm">${text}</div></div>`;
            } else {
                html = `<div class="flex gap-3 max-w-4xl mb-4"><div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-xs flex-shrink-0">AI</div><div class="bg-white border border-slate-200 p-4 rounded-2xl rounded-tl-none text-slate-700 text-sm shadow-sm">${text}</div></div>`;
            }
            container.insertAdjacentHTML('beforeend', html);
        }

        // --- AUTH OBSERVER ---
        onAuthStateChanged(auth, (user) => {
            const loginScreen = document.getElementById('login-screen');
            const appScreen = document.getElementById('app-screen');
            const userAvatar = document.getElementById('user-avatar-area');

            if (user && ALLOWED_USERS.includes(user.email)) {
                loginScreen.classList.add('hidden');
                appScreen.classList.remove('hidden');
                document.body.classList.remove('login-mode');
                
                if(userAvatar) {
                    userAvatar.innerHTML = `<div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition" onclick="handleLogout()" title="Sair de ${user.email}"><div class="text-right hidden sm:block"><p class="text-xs font-bold text-slate-900">${user.displayName}</p><p class="text-[10px] text-emerald-600 font-bold uppercase">Online</p></div><img src="${user.photoURL}" class="w-9 h-9 rounded-lg border border-slate-200 shadow-sm"></div>`;
                }
                window.loadChatHistory();
            } else {
                if(user) signOut(auth);
                loginScreen.classList.remove('hidden');
                appScreen.classList.add('hidden');
                document.body.classList.add('login-mode');
            }
        });
    </script>
</head>
<body class="bg-slate-50 text-slate-600 font-sans h-screen flex overflow-hidden login-mode">

    <div id="login-screen" class="fixed inset-0 z-50 bg-slate-50 flex flex-col items-center justify-center fade-in">
        <div class="w-full max-w-md bg-white p-10 rounded-2xl shadow-xl border border-slate-100 text-center relative">
            <div class="w-16 h-16 bg-slate-900 rounded-2xl flex items-center justify-center text-3xl font-bold text-white mx-auto mb-8 shadow-lg shadow-slate-200">V</div>
            <h1 class="text-2xl font-bold text-slate-900 mb-2 tracking-tight">Bem-vindo(a)!</h1>
            <p class="text-slate-500 text-sm mb-8">Acesse o ecossistema VZT com sua conta corporativa.</p>
            <div id="login-error-msg" class="hidden mb-4 p-3 bg-red-50 border border-red-100 text-red-600 text-xs rounded-lg font-bold"></div>
            <button id="btn-login-google" onclick="handleLogin()" class="w-full bg-white border border-slate-200 text-slate-700 font-semibold py-3.5 px-4 rounded-xl hover:bg-slate-50 hover:border-slate-300 transition-all flex items-center justify-center gap-3 mb-6 shadow-sm group">
                <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                <span class="group-hover:text-slate-900">Entrar com Google</span>
            </button>
            <div class="flex items-center gap-2 justify-center text-[10px] text-slate-400 uppercase tracking-widest font-bold"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span> Ambiente Seguro</div>
        </div>
        <p class="mt-8 text-xs text-slate-400">¬© 2024 VZT Ecossistema. Apenas pessoal autorizado.</p>
    </div>

    <div id="app-screen" class="hidden flex h-full w-full">
        
        <aside class="w-72 bg-vzt-black text-slate-400 flex flex-col z-30 flex-shrink-0 shadow-2xl">
            <div class="h-16 flex items-center px-6 border-b border-zinc-800">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-white text-black flex items-center justify-center font-bold text-lg rounded-lg shadow-lg">V</div>
                    <div>
                        <h1 class="text-white font-bold tracking-tight text-lg">VZT</h1>
                        <span class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">ECOSSISTEMA</span>
                    </div>
                </div>
            </div>

            <nav class="flex-1 py-6 px-3 space-y-1 overflow-y-auto">
                <div class="px-3 mb-2 mt-1 text-[10px] font-bold text-zinc-600 uppercase tracking-wider">Estrat√©gia & Growth</div>
                <button onclick="navTo('control-tower', this)" class="nav-btn nav-active w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                    <i data-lucide="layout-dashboard" class="w-4 h-4"></i><span class="text-sm font-medium">Control Tower</span>
                </button>
                <button onclick="navTo('crm', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                    <i data-lucide="filter" class="w-4 h-4"></i><span class="text-sm font-medium">CRM & Funil</span>
                </button>
                <button onclick="navTo('marketing', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white group">
                    <i data-lucide="bar-chart-2" class="w-4 h-4 text-orange-400 group-hover:text-white"></i><span class="text-sm font-medium">Marketing & Tr√°fego</span>
                </button>
                <button onclick="navTo('finance', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                    <i data-lucide="dollar-sign" class="w-4 h-4"></i><span class="text-sm font-medium">Financeiro</span>
                </button>

                <div class="px-3 mb-2 mt-6 text-[10px] font-bold text-zinc-600 uppercase tracking-wider">Opera√ß√£o & Equipe</div>
                <button onclick="navTo('tasks', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white group">
                    <i data-lucide="trello" class="w-4 h-4 text-emerald-400 group-hover:text-white"></i><span class="text-sm font-medium">Central de Tarefas</span>
                </button>
                <button onclick="navTo('patients', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                    <i data-lucide="users" class="w-4 h-4"></i><span class="text-sm font-medium">Pacientes 360¬∫</span>
                </button>
                <button onclick="navTo('agenda', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                    <i data-lucide="calendar" class="w-4 h-4"></i><span class="text-sm font-medium">Agenda M√©dica</span>
                </button>
                <button onclick="navTo('whatsapp', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                    <i data-lucide="message-circle" class="w-4 h-4"></i><span class="text-sm font-medium">WhatsApp Hub</span>
                </button>

                <div class="px-3 mb-2 mt-6 text-[10px] font-bold text-zinc-600 uppercase tracking-wider">VZT Intelligence</div>
                <button onclick="navTo('ai-chat', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white group">
                    <i data-lucide="bot" class="w-4 h-4 text-purple-400 group-hover:text-white"></i><span class="text-sm font-medium">VZT AI Chat</span>
                </button>
                <button onclick="navTo('ai-voice', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                    <i data-lucide="mic" class="w-4 h-4 text-blue-400"></i><span class="text-sm font-medium">AI Voice Recorder</span>
                </button>
                <button onclick="navTo('sops', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                    <i data-lucide="file-text" class="w-4 h-4"></i><span class="text-sm font-medium">Processos (SOPs)</span>
                </button>

                <div class="mt-auto pt-6 border-t border-zinc-800 mx-3 pb-4 space-y-1">
                    <button onclick="navTo('plugins', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                        <i data-lucide="plug" class="w-4 h-4"></i><span class="text-sm font-medium">Plugins Store</span>
                    </button>
                    <button onclick="navTo('settings', this)" class="nav-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-r-lg transition-all hover:bg-vzt-sidebarHover hover:text-white">
                        <i data-lucide="settings" class="w-4 h-4"></i><span class="text-sm font-medium">Configura√ß√µes</span>
                    </button>
                </div>
            </nav>
        </aside>

        <main class="flex-1 flex flex-col relative overflow-hidden bg-slate-50">
            <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 z-20 shadow-sm">
                <div class="flex items-center gap-4">
                    <h2 id="page-title" class="text-lg font-bold text-slate-800">Control Tower</h2>
                    <div class="flex items-center gap-2 px-3 py-1 bg-slate-100 rounded-full border border-slate-200 cursor-pointer hover:bg-slate-200 transition">
                        <i data-lucide="building-2" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-xs font-semibold text-slate-600">Cl√≠nica Dr. Mateus (Matriz)</span>
                        <i data-lucide="chevron-down" class="w-3 h-3 text-slate-400"></i>
                    </div>
                </div>
                <div class="flex items-center gap-6">
                    <div class="hidden md:flex items-center gap-2 text-xs font-medium text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-100">
                        <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                        Ecossistema Online
                    </div>
                    <div id="user-avatar-area" class="flex items-center gap-4">
                        <span class="text-xs text-slate-400">Carregando...</span>
                    </div>
                </div>
            </header>

            <div id="content-area" class="flex-1 overflow-y-auto p-0 scroll-smooth relative">

                <div id="view-control-tower" class="view-section space-y-8 p-8 fade-in">
                    <div class="flex justify-between items-end">
                        <div><h1 class="text-2xl font-bold text-slate-900">Vis√£o Operacional</h1><p class="text-slate-500">Resumo executivo do dia.</p></div>
                        <div class="flex gap-3">
                            <button class="px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 shadow-sm flex items-center gap-2"><i data-lucide="file-bar-chart" class="w-4 h-4"></i> Relat√≥rio</button>
                            <button class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-slate-800 shadow-lg flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i> Nova A√ß√£o</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white border border-slate-200 p-5 rounded-xl shadow-sm flex flex-col"><div class="flex justify-between mb-2"><span class="text-xs font-bold text-slate-500 uppercase">Pacientes Hoje</span><i data-lucide="users" class="w-4 h-4 text-blue-500"></i></div><h3 class="text-2xl font-bold text-slate-900">12</h3><p class="text-xs text-slate-400 mt-auto">8 Confirmados / 4 Pendentes</p></div>
                        <div class="bg-white border border-slate-200 p-5 rounded-xl shadow-sm flex flex-col"><div class="flex justify-between mb-2"><span class="text-xs font-bold text-slate-500 uppercase">Cirurgias</span><i data-lucide="activity" class="w-4 h-4 text-purple-500"></i></div><h3 class="text-2xl font-bold text-slate-900">2</h3><p class="text-xs text-slate-400 mt-auto">Lipo HD (Manh√£)</p></div>
                        <div class="bg-white border border-slate-200 p-5 rounded-xl shadow-sm flex flex-col"><div class="flex justify-between mb-2"><span class="text-xs font-bold text-slate-500 uppercase">WhatsApp</span><i data-lucide="message-circle" class="w-4 h-4 text-green-500"></i></div><h3 class="text-2xl font-bold text-slate-900">5</h3><p class="text-xs text-amber-500 font-bold">Aguardando Resposta</p></div>
                        <div class="bg-white border border-slate-200 p-5 rounded-xl shadow-sm flex flex-col"><div class="flex justify-between mb-2"><span class="text-xs font-bold text-slate-500 uppercase">Faturamento Dia</span><i data-lucide="dollar-sign" class="w-4 h-4 text-emerald-500"></i></div><h3 class="text-2xl font-bold text-slate-900">R$ 24.500</h3><p class="text-xs text-emerald-600 font-bold mt-auto">Meta Batida</p></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[500px]">
                        <div class="bg-white border border-slate-200 rounded-xl shadow-sm flex flex-col overflow-hidden h-full"><div class="p-5 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center"><h3 class="font-bold text-slate-800 flex items-center gap-2"><i data-lucide="calendar-clock" class="w-4 h-4 text-blue-600"></i> Agenda (Next)</h3></div><div class="p-0 overflow-y-auto flex-1 divide-y divide-slate-50"><div class="p-4 bg-blue-50/30 border-l-4 border-blue-500"><div class="flex justify-between items-start mb-1"><span class="text-sm font-bold text-blue-700">14:00 (Agora)</span><span class="text-[10px] font-bold px-2 py-0.5 rounded bg-emerald-100 text-emerald-700 uppercase">Em Sala</span></div><h4 class="font-bold text-slate-900">Silva, Ana Maria - 123.456.789-00</h4><p class="text-xs text-slate-500">Retorno P√≥s-Op</p></div><div class="p-4 hover:bg-slate-50"><div class="flex justify-between items-start mb-1"><span class="text-sm font-bold text-slate-700">15:00</span><span class="text-[10px] font-bold px-2 py-0.5 rounded bg-slate-200 text-slate-600 uppercase">Confirmado</span></div><h4 class="font-bold text-slate-800">Souza, Carlos - 987.654.321-11</h4><p class="text-xs text-slate-500">Avalia√ß√£o</p></div></div></div>
                        <div class="bg-white border border-slate-200 rounded-xl shadow-sm flex flex-col overflow-hidden h-full"><div class="p-5 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center"><h3 class="font-bold text-slate-800 flex items-center gap-2"><i data-lucide="check-square" class="w-4 h-4 text-slate-600"></i> Tasks (Hoje)</h3><button class="text-xs font-bold text-slate-400 hover:text-slate-600">+ Add</button></div><div class="p-4 space-y-3 overflow-y-auto flex-1"><div class="flex items-start gap-3 p-3 bg-white border border-red-100 rounded-lg shadow-sm group"><input type="checkbox" class="task-checkbox mt-1 w-4 h-4 rounded border-slate-300 text-blue-600"><div class="flex-1"><p class="text-sm font-semibold text-slate-800">Confirmar cirurgias</p><div class="flex items-center gap-2 mt-1"><span class="text-[10px] bg-slate-100 text-slate-500 px-1.5 rounded">Recep√ß√£o</span><span class="text-[10px] text-red-500 font-bold">Alta</span></div></div></div><div class="flex items-start gap-3 p-3 bg-white border border-slate-200 rounded-lg shadow-sm"><input type="checkbox" class="task-checkbox mt-1 w-4 h-4 rounded border-slate-300 text-blue-600"><div class="flex-1"><p class="text-sm font-medium text-slate-700">Emitir NFs</p><div class="flex items-center gap-2 mt-1"><span class="text-[10px] bg-slate-100 text-slate-500 px-1.5 rounded">Financeiro</span></div></div></div></div></div>
                        <div class="bg-white border border-slate-200 rounded-xl shadow-sm flex flex-col overflow-hidden h-full"><div class="p-5 border-b border-slate-100 bg-slate-50/50"><h3 class="font-bold text-slate-800 flex items-center gap-2"><i data-lucide="cpu" class="w-4 h-4 text-slate-600"></i> Plugins</h3></div><div class="p-4 space-y-4 flex-1 overflow-y-auto"><div class="flex items-center justify-between p-2 rounded hover:bg-slate-50"><div class="flex items-center gap-3"><div class="w-2 h-2 rounded-full bg-green-500"></div><span class="text-sm font-bold text-slate-700">HubSpot CRM</span></div><span class="text-xs font-bold text-emerald-600">OK</span></div><div class="flex items-center justify-between p-2 rounded hover:bg-slate-50"><div class="flex items-center gap-3"><div class="w-2 h-2 rounded-full bg-green-500"></div><span class="text-sm font-bold text-slate-700">Google Calendar</span></div><span class="text-xs font-bold text-emerald-600">OK</span></div></div></div>
                    </div>
                </div>

                <div id="view-tasks" class="view-section hidden h-full flex flex-col p-8 fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <div><h1 class="text-2xl font-bold text-slate-900">Central de Tarefas</h1><p class="text-slate-500">Gest√£o integrada com pacientes.</p></div>
                        <button onclick="openTaskModal()" class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium flex items-center gap-2 hover:bg-slate-800 transition"><i data-lucide="plus" class="w-4 h-4"></i> Nova Tarefa</button>
                    </div>
                    <div class="flex-1 overflow-x-auto pb-4 flex gap-4 kanban-scroll">
                        <div class="kanban-col flex flex-col bg-slate-100 rounded-xl p-2 h-full w-80 flex-shrink-0"><div class="flex justify-between items-center mb-3 px-2 pt-2"><h3 class="font-bold text-slate-700 text-sm">A Fazer</h3><span class="bg-slate-200 text-slate-600 text-xs font-bold px-2 py-0.5 rounded-full">3</span></div><div class="space-y-2 overflow-y-auto flex-1 p-1" id="col-todo"></div></div>
                        <div class="kanban-col flex flex-col bg-slate-100 rounded-xl p-2 h-full w-80 flex-shrink-0"><div class="flex justify-between items-center mb-3 px-2 pt-2"><h3 class="font-bold text-slate-700 text-sm">Em Andamento</h3><span class="bg-blue-100 text-blue-700 text-xs font-bold px-2 py-0.5 rounded-full">2</span></div><div class="space-y-2 overflow-y-auto flex-1 p-1" id="col-progress"></div></div>
                        <div class="kanban-col flex flex-col bg-slate-100 rounded-xl p-2 h-full w-80 flex-shrink-0"><div class="flex justify-between items-center mb-3 px-2 pt-2"><h3 class="font-bold text-slate-700 text-sm">Conclu√≠do</h3><span class="bg-emerald-100 text-emerald-700 text-xs font-bold px-2 py-0.5 rounded-full">12</span></div><div class="space-y-2 overflow-y-auto flex-1 p-1 opacity-60" id="col-done"></div></div>
                    </div>
                </div>

                <div id="view-marketing" class="view-section hidden space-y-8 p-8 fade-in">
                    <div class="flex justify-between items-end">
                        <div><h1 class="text-2xl font-bold text-slate-900">Performance de Marketing</h1><p class="text-slate-500">An√°lise de Tr√°fego Pago e Org√¢nico.</p></div>
                        <div class="flex items-center gap-3">
                            <select class="bg-white border border-slate-200 text-sm rounded-lg px-3 py-2"><option>√öltimos 30 Dias</option></select>
                            <button class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium flex items-center gap-2"><i data-lucide="refresh-cw" class="w-4 h-4"></i> Atualizar Dados</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm"><p class="text-xs font-bold text-slate-500 uppercase">Investimento (Ads)</p><h3 class="text-2xl font-bold text-slate-900">R$ 4.500</h3><p class="text-xs text-slate-400 mt-1">Meta/Google</p></div>
                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm"><p class="text-xs font-bold text-slate-500 uppercase">Leads Gerados</p><h3 class="text-2xl font-bold text-slate-900">142</h3><p class="text-xs text-emerald-600 mt-1 font-bold">CPL: R$ 31,69</p></div>
                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm"><p class="text-xs font-bold text-slate-500 uppercase">Vendas (Origem MKT)</p><h3 class="text-2xl font-bold text-slate-900">R$ 68.000</h3><p class="text-xs text-slate-400 mt-1">12 Pacientes</p></div>
                        <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-emerald-500"><p class="text-xs font-bold text-slate-500 uppercase">ROAS (Retorno)</p><h3 class="text-2xl font-bold text-emerald-600">15.1x</h3><p class="text-xs text-slate-400 mt-1">Excelente</p></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white border border-slate-200 rounded-xl p-6 shadow-sm">
                            <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-2"><i data-lucide="bar-chart" class="w-4 h-4 text-orange-500"></i> Evolu√ß√£o de Leads x Custo</h3>
                            <div class="h-64 flex items-end justify-between gap-2 px-2 border-b border-slate-100 pb-2">
                                <div class="w-full bg-orange-100 rounded-t bar-container" style="height: 40%"><div class="absolute bottom-0 w-full bg-orange-500 h-full opacity-80 rounded-t"></div></div>
                                <div class="w-full bg-orange-100 rounded-t bar-container" style="height: 55%"><div class="absolute bottom-0 w-full bg-orange-500 h-full opacity-80 rounded-t"></div></div>
                                <div class="w-full bg-orange-100 rounded-t bar-container" style="height: 70%"><div class="absolute bottom-0 w-full bg-orange-500 h-full opacity-80 rounded-t"></div></div>
                                <div class="w-full bg-orange-100 rounded-t bar-container" style="height: 60%"><div class="absolute bottom-0 w-full bg-orange-500 h-full opacity-80 rounded-t"></div></div>
                                <div class="w-full bg-orange-100 rounded-t bar-container" style="height: 85%"><div class="absolute bottom-0 w-full bg-orange-500 h-full opacity-80 rounded-t"></div></div>
                            </div>
                            <div class="flex justify-center gap-6 mt-4 text-xs"><span class="flex items-center gap-1"><div class="w-2 h-2 bg-orange-500 rounded-full"></div> Leads</span><span class="flex items-center gap-1"><div class="w-2 h-2 bg-orange-100 rounded-full"></div> Investimento</span></div>
                        </div>
                        <div class="bg-white border border-slate-200 rounded-xl flex flex-col shadow-sm">
                            <div class="p-5 border-b border-slate-100"><h3 class="font-bold text-slate-800">Top Campanhas</h3></div>
                            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                                <div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded bg-gradient-to-tr from-yellow-400 to-purple-600 flex items-center justify-center text-white"><i data-lucide="instagram" class="w-4 h-4"></i></div><div><p class="text-sm font-bold text-slate-800">Lipo HD</p><p class="text-[10px] text-slate-500">Feed</p></div></div><div class="text-right"><p class="text-xs font-bold text-slate-800">45 Leads</p><p class="text-[10px] text-emerald-600">R$ 12,50/lead</p></div></div>
                                <div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded bg-blue-500 flex items-center justify-center text-white"><i data-lucide="search" class="w-4 h-4"></i></div><div><p class="text-sm font-bold text-slate-800">Rino</p><p class="text-[10px] text-slate-500">Google</p></div></div><div class="text-right"><p class="text-xs font-bold text-slate-800">28 Leads</p><p class="text-[10px] text-emerald-600">R$ 45,00/lead</p></div></div>
                                <div class="flex items-center justify-between opacity-60"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded bg-blue-700 flex items-center justify-center text-white"><i data-lucide="facebook" class="w-4 h-4"></i></div><div><p class="text-sm font-bold text-slate-800">Botox Promo</p><p class="text-[10px] text-slate-500">Facebook</p></div></div><div class="text-right"><p class="text-xs font-bold text-slate-800">10 Leads</p><p class="text-[10px] text-red-500">R$ 80,00/lead</p></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-crm" class="view-section hidden h-full flex flex-col p-8 fade-in">
                    <div class="flex justify-between items-center mb-6"><div><h1 class="text-2xl font-bold text-slate-900">Pipeline Comercial</h1></div><div class="flex gap-3"><input type="text" placeholder="Buscar Lead..." class="bg-white border rounded-lg px-3 py-2 text-sm w-64"><button class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i> Novo Lead</button></div></div>
                    <div class="flex-1 overflow-x-auto pb-4 flex gap-4 kanban-scroll">
                        <div class="kanban-col flex flex-col bg-slate-100 rounded-xl p-2 h-full"><div class="flex justify-between items-center mb-3 px-2 pt-2"><h3 class="font-bold text-slate-700 text-sm">Novo Lead</h3><span class="bg-slate-200 text-slate-600 text-xs font-bold px-2 py-0.5 rounded-full">12</span></div><div class="space-y-2 overflow-y-auto flex-1"><div class="bg-white p-3 rounded-lg border border-slate-200 shadow-sm cursor-pointer"><div class="flex justify-between mb-1"><span class="font-bold text-slate-800 text-sm">Costa, Mariana - 555...</span><span class="text-xs text-slate-400">2h</span></div><p class="text-xs text-slate-500">Rinoplastia</p></div></div></div>
                        <div class="kanban-col flex flex-col bg-slate-100 rounded-xl p-2 h-full"><div class="flex justify-between items-center mb-3 px-2 pt-2"><h3 class="font-bold text-slate-700 text-sm">Agendamento</h3><span class="bg-slate-200 text-slate-600 text-xs font-bold px-2 py-0.5 rounded-full">5</span></div><div class="space-y-2 overflow-y-auto flex-1"><div class="bg-white p-3 rounded-lg border border-slate-200 shadow-sm cursor-pointer"><div class="flex justify-between mb-1"><span class="font-bold text-slate-800 text-sm">Dias, Carla - 444...</span><span class="text-xs text-slate-400">1d</span></div><p class="text-xs text-slate-500">Lipo HD</p></div></div></div>
                        <div class="kanban-col flex flex-col bg-slate-100 rounded-xl p-2 h-full"><div class="flex justify-between items-center mb-3 px-2 pt-2"><h3 class="font-bold text-slate-700 text-sm">Negocia√ß√£o</h3><span class="bg-slate-200 text-slate-600 text-xs font-bold px-2 py-0.5 rounded-full">8</span></div><div class="space-y-2 overflow-y-auto flex-1"><div class="bg-white p-3 rounded-lg border border-l-4 border-l-amber-400 border-slate-200 shadow-sm"><div class="flex justify-between mb-1"><span class="font-bold text-slate-800 text-sm">M., Luiza - 333...</span><span class="text-xs text-amber-600 font-bold">Aten√ß√£o</span></div><p class="text-xs text-slate-500">Or√ßamento Enviado</p></div></div></div>
                        <div class="kanban-col flex flex-col bg-slate-100 rounded-xl p-2 h-full"><div class="flex justify-between items-center mb-3 px-2 pt-2"><h3 class="font-bold text-slate-700 text-sm">Fechado / Ganho</h3><span class="bg-slate-200 text-slate-600 text-xs font-bold px-2 py-0.5 rounded-full">42</span></div><div class="space-y-2 overflow-y-auto flex-1"><div class="bg-emerald-50 p-3 rounded-lg border border-emerald-100 shadow-sm"><div class="flex justify-between mb-1"><span class="font-bold text-emerald-900 text-sm">Silva, Ana - 123...</span><span class="text-xs text-emerald-600">Pago</span></div><p class="text-xs text-emerald-700">Botox Day</p></div></div></div>
                    </div>
                </div>

                <div id="view-finance" class="view-section hidden space-y-6 p-8 fade-in">
                    <div class="flex justify-between items-end"><div><h1 class="text-2xl font-bold text-slate-900">Gest√£o Financeira</h1><p class="text-slate-500">DRE e Fluxo de Caixa.</p></div></div>
                    <div class="grid grid-cols-3 gap-6"><div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm"><p class="text-xs font-bold text-slate-500 uppercase">Receita Bruta</p><h3 class="text-2xl font-bold text-slate-900">R$ 185.400</h3></div><div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm"><p class="text-xs font-bold text-slate-500 uppercase">Despesas</p><h3 class="text-2xl font-bold text-red-600">R$ 92.100</h3></div><div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm bg-emerald-50/50 border-emerald-100"><p class="text-xs font-bold text-emerald-600 uppercase">Lucro L√≠quido</p><h3 class="text-2xl font-bold text-emerald-700">R$ 93.300</h3></div></div>
                </div>

                <div id="view-patients" class="view-section hidden p-8 fade-in h-full flex flex-col relative">
                    <div id="patients-list-container" class="flex-1 flex flex-col space-y-6">
                        <div class="flex justify-between items-center">
                            <div><h1 class="text-2xl font-bold text-slate-900">Base de Pacientes</h1><p class="text-slate-500">Prontu√°rio Unificado.</p></div>
                            <div class="flex items-center gap-3">
                                <div class="flex items-center gap-2 bg-white border border-slate-200 px-3 py-2 rounded-lg w-64 shadow-sm"><i data-lucide="search" class="w-4 h-4 text-slate-400"></i><input type="text" placeholder="Buscar..." class="bg-transparent text-sm w-full outline-none"></div>
                                <button onclick="openPatientModal()" class="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-purple-700 shadow-lg transition"><i data-lucide="plus" class="w-4 h-4"></i> Novo Paciente</button>
                            </div>
                        </div>
                        <div class="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm flex-1"><table class="w-full text-sm text-left"><thead class="text-xs text-slate-500 bg-slate-50 uppercase font-medium border-b border-slate-200"><tr><th class="px-6 py-4">Paciente (Sobrenome, Nome - CPF)</th><th class="px-6 py-4">Status</th><th class="px-6 py-4">Procedimento</th><th class="px-6 py-4">√öltima Intera√ß√£o</th><th class="px-6 py-4 text-right">A√ß√£o</th></tr></thead><tbody class="divide-y divide-slate-100" id="patients-table-body"></tbody></table></div>
                    </div>
                    <div id="patient-detail-view" class="hidden absolute inset-0 bg-slate-50 p-8 z-20 overflow-y-auto">
                        <button onclick="closePatientProfile()" class="mb-6 flex items-center gap-2 text-sm font-bold text-slate-500 hover:text-slate-800"><i data-lucide="arrow-left" class="w-4 h-4"></i> Voltar</button>
                        <div class="bg-white border border-slate-200 rounded-xl p-6 shadow-sm mb-6 flex justify-between items-start">
                            <div class="flex gap-6"><div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center text-3xl font-bold text-slate-400 border-4 border-white shadow-md" id="p-avatar">AS</div><div><h1 class="text-3xl font-bold text-slate-900" id="p-name">Silva, Ana Maria - 123...</h1><div class="flex gap-2 mt-2"><span class="px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-xs font-bold uppercase" id="p-status">P√≥s-Op</span></div></div></div>
                            <div class="flex gap-3">
                                <button class="px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-slate-50 shadow-sm"><i data-lucide="folder" class="w-4 h-4 text-blue-600"></i> Google Drive Sync</button>
                                <button class="px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-slate-50 shadow-sm"><i data-lucide="message-circle" class="w-4 h-4 text-green-500"></i> WhatsApp</button>
                            </div>
                        </div>
                        
                        <div class="flex gap-6 border-b border-slate-200 mb-6">
                            <button class="pb-3 border-b-2 border-slate-900 font-bold text-slate-900 text-sm">Geral & Timeline</button>
                            <button class="pb-3 border-b-2 border-transparent text-slate-500 text-sm hover:text-slate-700 flex items-center gap-2"><i data-lucide="check-square" class="w-4 h-4"></i> Tarefas</button>
                            <button class="pb-3 border-b-2 border-transparent text-slate-500 text-sm hover:text-slate-700 flex items-center gap-2"><i data-lucide="mic" class="w-4 h-4"></i> Grava√ß√µes</button>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2 space-y-6">
                                <div class="bg-white border border-slate-200 rounded-xl p-6 shadow-sm"><h3 class="font-bold text-slate-900 mb-6 flex items-center gap-2"><i data-lucide="history" class="w-5 h-5 text-blue-600"></i> Timeline</h3><div class="space-y-6 border-l-2 border-slate-100 pl-6 relative" id="p-timeline"></div></div>
                            </div>
                            <div class="bg-white border border-slate-200 rounded-xl p-6 shadow-sm h-fit">
                                <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-900">Tarefas Vinculadas</h3></div>
                                <div class="space-y-3" id="p-tasks-widget"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-agenda" class="view-section hidden space-y-6 p-8 fade-in">
                    <div class="flex justify-between items-center"><div><h1 class="text-2xl font-bold text-slate-900">Agenda M√©dica</h1></div><div class="flex gap-2"><button class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium flex items-center gap-2"><i data-lucide="refresh-cw" class="w-4 h-4"></i> Sync</button></div></div>
                    <div class="bg-white border border-slate-200 rounded-xl p-6 shadow-sm min-h-[600px]"><div class="grid grid-cols-1 divide-y divide-slate-100"><div class="py-4 flex gap-6"><span class="text-slate-400 w-12 text-sm font-bold text-right">09:00</span><div class="flex-1 bg-blue-50 border-l-4 border-blue-500 p-3 rounded text-sm"><span class="font-bold text-slate-800 block">Silva, Ana Maria - 123...</span><span class="text-slate-500 text-xs">Sala 1</span></div></div><div class="py-4 flex gap-6"><span class="text-slate-400 w-12 text-sm font-bold text-right">10:00</span><div class="flex-1 bg-purple-50 border-l-4 border-purple-500 p-3 rounded text-sm"><span class="font-bold text-slate-800 block">Souza, Carlos - 987...</span><span class="text-slate-500 text-xs">Centro Cir√∫rgico</span></div></div></div></div>
                </div>

                <div id="view-whatsapp" class="view-section hidden h-full flex fade-in bg-white">
                    <div class="w-80 border-r border-slate-200 flex flex-col bg-slate-50"><div class="p-4 border-b border-slate-200"><h3 class="font-bold text-slate-800">Conversas (3)</h3></div><div class="flex-1 overflow-y-auto"><div class="p-4 border-b border-slate-100 bg-white border-l-4 border-l-blue-500 cursor-pointer"><div class="flex justify-between mb-1"><span class="font-bold text-slate-900">Silva, Ana Maria</span><span class="text-xs text-slate-400">14:30</span></div><p class="text-xs text-slate-500 truncate">Doutor, meu rosto est√° inchado...</p></div></div></div>
                    <div class="flex-1 flex flex-col bg-white"><div class="p-4 border-b border-slate-200 flex justify-between items-center bg-slate-50"><h3 class="font-bold text-slate-800">Silva, Ana Maria</h3></div><div class="flex-1 p-6 bg-white space-y-4 overflow-y-auto"><div class="flex justify-end"><div class="bg-blue-600 text-white p-3 rounded-l-xl rounded-tr-xl text-sm max-w-md">Ol√° Ana, como est√° se sentindo hoje?</div></div><div class="flex justify-start"><div class="bg-slate-100 text-slate-700 p-3 rounded-r-xl rounded-tl-xl text-sm max-w-md shadow-sm">Doutor, meu rosto est√° um pouco inchado, √© normal?</div></div></div><div class="p-4 border-t border-slate-200 bg-slate-50 flex gap-3"><input type="text" placeholder="Digite..." class="flex-1 border rounded-lg px-4 py-2 text-sm"><button class="p-2 bg-slate-900 text-white rounded-lg"><i data-lucide="send" class="w-5 h-5"></i></button></div></div>
                </div>

                <div id="view-ai-chat" class="view-section hidden h-full flex p-0 fade-in">
                    <div class="w-64 border-r border-slate-200 bg-slate-50 flex flex-col">
                        <div class="p-4 font-bold text-sm text-slate-500 uppercase tracking-wider">Hist√≥rico</div>
                        <div class="flex-1 overflow-y-auto p-2 space-y-2">
                            <div class="p-3 bg-white border border-slate-200 rounded-lg text-sm cursor-pointer hover:border-purple-300 shadow-sm"><p class="font-bold text-slate-800">DRE Novembro</p><span class="text-[10px] text-slate-400">Ontem - Adm</span></div>
                            <div class="p-3 bg-white border border-slate-200 rounded-lg text-sm cursor-pointer hover:border-purple-300 shadow-sm"><p class="font-bold text-slate-800">P√≥s-Op Ana</p><span class="text-[10px] text-slate-400">Hoje - Paciente</span></div>
                        </div>
                    </div>
                    <div class="flex-1 flex flex-col relative bg-white">
                        <div class="h-16 border-b border-slate-200 flex items-center justify-between px-6">
                            <div><h1 class="text-xl font-bold text-slate-900">VZT AI</h1></div>
                            <div class="flex items-center gap-3">
                                <select id="chat-context-select" class="patient-select bg-slate-100 border border-slate-200 rounded-lg px-3 py-2 text-xs font-medium text-slate-700 outline-none"><option value="Administrativo">üìÅ Geral / Adm</option></select>
                                <div class="text-xs font-bold px-2 py-1 bg-purple-100 text-purple-700 rounded flex items-center gap-1"><i data-lucide="sparkles" class="w-3 h-3"></i> Gemini</div>
                            </div>
                        </div>
                        <div id="chat-messages-area" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
                        <div class="p-4 border-t border-slate-100">
                            <div class="flex gap-3 bg-slate-50 p-2 rounded-xl border border-slate-200 shadow-inner">
                                <input id="chat-input" type="text" class="flex-1 bg-transparent px-4 py-2 text-sm focus:outline-none text-slate-700" placeholder="Digite sua mensagem..." onkeypress="if(event.key === 'Enter') sendToCloud()">
                                <button onclick="sendToCloud()" class="bg-slate-900 text-white px-6 rounded-lg font-bold hover:bg-slate-800 transition flex items-center gap-2"><span>Enviar</span> <i data-lucide="send" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-ai-voice" class="view-section hidden h-full flex p-0 fade-in">
                    <div class="w-64 border-r border-slate-200 bg-slate-50 flex flex-col">
                        <div class="p-4 font-bold text-sm text-slate-500 uppercase tracking-wider">Grava√ß√µes</div>
                        <div class="flex-1 overflow-y-auto p-2 space-y-2">
                            <div class="p-3 bg-white border border-slate-200 rounded-lg text-sm cursor-pointer hover:shadow-md transition">
                                <div class="flex justify-between mb-1"><i data-lucide="mic" class="w-4 h-4 text-blue-500"></i><i data-lucide="check" class="w-3 h-3 text-emerald-500"></i></div>
                                <p class="font-bold text-slate-800">Consulta Inicial</p><span class="text-[10px] text-slate-400">Silva, Ana... ‚Ä¢ 10:00</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1 flex items-center justify-center bg-slate-50 p-8">
                        <div class="bg-white border border-slate-200 rounded-2xl p-10 text-center shadow-lg max-w-lg w-full">
                            <div class="mb-8">
                                <div class="w-24 h-24 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-6 border-4 border-blue-100 shadow-xl"><i data-lucide="mic" class="w-10 h-10"></i></div>
                                <h2 class="text-2xl font-bold text-slate-900">Gravador Inteligente</h2><p class="text-slate-500 text-sm mt-2">√Åudio transcrito e salvo no Drive.</p>
                            </div>
                            <div class="mb-8 text-left">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Vincular a:</label>
                                <select class="patient-select w-full border border-slate-300 rounded-lg px-4 py-3 text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none"><option value="Administrativo">üìÅ Geral / Adm</option></select>
                            </div>
                            <button class="w-full py-4 bg-slate-900 text-white font-bold rounded-xl flex items-center justify-center gap-3 shadow-lg hover:scale-105 transition transform"><i data-lucide="play" class="w-5 h-5"></i> Iniciar Grava√ß√£o</button>
                        </div>
                    </div>
                </div>

                <div id="view-sops" class="view-section hidden space-y-8 p-8 fade-in">
                    <div class="flex justify-between items-center"><div><h1 class="text-2xl font-bold text-slate-900">Protocolos (SOPs)</h1></div><button class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i> Novo Doc</button></div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm cursor-pointer"><h4 class="font-bold text-slate-900">Onboarding de Leads</h4><p class="text-xs text-slate-500 mt-1">Scripts de vendas.</p></div><div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm cursor-pointer"><h4 class="font-bold text-slate-900">Checklist Cir√∫rgico</h4><p class="text-xs text-slate-500 mt-1">Sala e materiais.</p></div></div>
                </div>

                <div id="view-plugins" class="view-section hidden p-8 space-y-8 fade-in bg-slate-50 h-full overflow-y-auto">
                    <div class="flex justify-between items-end"><div><h1 class="text-2xl font-bold text-slate-900">Plugins Store</h1></div></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><div class="bg-white p-6 rounded-xl border border-emerald-200 shadow-sm relative overflow-hidden group"><div class="absolute top-0 right-0 bg-emerald-500 text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg">Instalado</div><div class="flex items-start gap-4 mb-4"><div class="w-12 h-12 bg-[#ff7a59] rounded-xl flex items-center justify-center text-white text-xl font-bold shadow-sm">HS</div><div><h3 class="font-bold text-slate-900">HubSpot CRM</h3></div></div><button class="w-full py-2 border border-slate-200 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50">Configurar</button></div></div>
                </div>

                <div id="view-settings" class="view-section hidden p-8 max-w-5xl mx-auto space-y-8 fade-in">
                    <div><h1 class="text-2xl font-bold text-slate-900">Configura√ß√µes Globais</h1></div>
                    <div class="border-b border-slate-200 flex gap-6"><button class="pb-3 border-b-2 border-slate-900 font-bold text-slate-900 text-sm">Organiza√ß√£o</button><button class="pb-3 border-b-2 border-transparent text-slate-500 text-sm hover:text-slate-700">Usu√°rios</button></div>
                    <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-6 space-y-4"><h3 class="font-bold text-slate-800">Detalhes da Cl√≠nica</h3><div class="grid grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nome</label><input type="text" value="Cl√≠nica Dr. Mateus" class="w-full border rounded px-3 py-2 text-sm"></div></div></div>
                </div>

            </div>
        </main>
    </div>

    <div id="task-modal" class="hidden fixed inset-0 z-50 bg-black/50 flex items-center justify-center fade-in">
        <div class="bg-white p-6 rounded-xl w-96 shadow-2xl">
            <h3 class="font-bold text-lg mb-4">Nova Tarefa</h3>
            <input id="new-task-title" type="text" placeholder="T√≠tulo da tarefa..." class="w-full border border-slate-300 rounded-lg p-3 mb-4 text-sm focus:border-blue-500 outline-none">
            <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">Vincular Paciente (Opcional)</label>
            <select id="new-task-patient" class="patient-select w-full border border-slate-300 rounded-lg p-3 mb-6 text-sm bg-white focus:border-blue-500 outline-none"><option value="">Nenhum (Geral)</option></select>
            <div class="flex justify-end gap-2">
                <button onclick="document.getElementById('task-modal').classList.add('hidden')" class="px-4 py-2 text-sm text-slate-500 hover:bg-slate-100 rounded-lg font-medium">Cancelar</button>
                <button onclick="addNewTaskMock()" class="px-6 py-2 text-sm bg-slate-900 text-white rounded-lg font-bold hover:bg-slate-800 shadow-md">Salvar Tarefa</button>
            </div>
        </div>
    </div>

    <div id="patient-modal" class="hidden fixed inset-0 z-50 bg-black/60 flex items-center justify-center fade-in backdrop-blur-sm">
        <div class="bg-white p-8 rounded-2xl w-[480px] shadow-2xl relative">
            <button onclick="document.getElementById('patient-modal').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i data-lucide="x" class="w-5 h-5"></i></button>
            <div class="mb-6 text-center">
                <div class="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-3"><i data-lucide="folder-plus" class="w-6 h-6"></i></div>
                <h3 class="font-bold text-xl text-slate-900">Novo Prontu√°rio</h3><p class="text-sm text-slate-500">Cria√ß√£o autom√°tica no Google Drive.</p>
            </div>
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nome</label><input id="input-nome" type="text" placeholder="Ex: Ana Maria" class="w-full border border-slate-300 rounded-lg px-3 py-2.5 text-sm focus:border-blue-500 outline-none"></div>
                    <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Sobrenome</label><input id="input-sobrenome" type="text" placeholder="Ex: Silva" class="w-full border border-slate-300 rounded-lg px-3 py-2.5 text-sm focus:border-blue-500 outline-none"></div>
                </div>
                <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">CPF (Obrigat√≥rio)</label><input id="input-cpf" type="text" placeholder="000.000.000-00" class="w-full border border-slate-300 rounded-lg px-3 py-2.5 text-sm focus:border-blue-500 outline-none"><p class="text-[10px] text-slate-400 mt-1">Garante a pasta √∫nica.</p></div>
            </div>
            <div class="mt-8"><button id="btn-create-patient" onclick="createPatientDrive()" class="w-full py-3 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition flex items-center justify-center gap-2"><span>Criar Prontu√°rio & Drive</span><i data-lucide="arrow-right" class="w-4 h-4"></i></button></div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        // DADOS MESTRES
        const patientsDB = [
            { id: 1, name: "Silva, Ana Maria - 123.456.789-00", status: "P√≥s-Operat√≥rio", procedure: "Lipoaspira√ß√£o HD" },
            { id: 2, name: "Souza, Carlos - 987.654.321-11", status: "Pr√©-Operat√≥rio", procedure: "Rinoplastia" },
            { id: 3, name: "Costa, Mariana - 555.444.333-22", status: "Negocia√ß√£o", procedure: "Botox" }
        ];

        let tasksDB = [
            { id: 101, title: "Comprar Fios", patientId: "", status: "todo" },
            { id: 102, title: "Revisar Exames", patientId: "1", status: "todo" }
        ];

        // ROB√î DRIVE URL (Cole aqui)
        const ROBOT_URL_CREATE = "https://console.firebase.google.com/project/vzt-ecossistema/overview";

        document.addEventListener('DOMContentLoaded', () => {
            populatePatientSelects();
            renderKanbanBoard();
            renderPatientsTable();
        });

        function populatePatientSelects() {
            const selects = document.querySelectorAll('.patient-select');
            selects.forEach(select => {
                const defaultOpt = select.firstElementChild; 
                select.innerHTML = '';
                if(defaultOpt) select.appendChild(defaultOpt);
                patientsDB.forEach(p => {
                    const opt = document.createElement('option');
                    opt.value = p.id;
                    opt.innerText = p.name;
                    select.appendChild(opt);
                });
            });
        }

        function navTo(viewId, btnElement) {
            if(btnElement) {
                document.querySelectorAll('.nav-btn').forEach(el => { el.classList.remove('nav-active'); el.classList.add('text-slate-400'); });
                btnElement.classList.add('nav-active'); btnElement.classList.remove('text-slate-400');
            }
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById('view-' + viewId);
            if(target) target.classList.remove('hidden');
            
            if(viewId === 'tasks') renderKanbanBoard();
            if(viewId === 'patients') renderPatientsTable();
            if(viewId === 'ai-chat' && window.loadChatHistory) window.loadChatHistory();
        }

        function renderPatientsTable() {
            const tbody = document.getElementById('patients-table-body');
            tbody.innerHTML = '';
            patientsDB.forEach(p => {
                tbody.innerHTML += `<tr class="hover:bg-slate-50 transition-colors cursor-pointer" onclick="openPatientProfile(${p.id})"><td class="px-6 py-4 font-semibold text-slate-900">${p.name}</td><td class="px-6 py-4"><span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs font-bold">${p.status}</span></td><td class="px-6 py-4 text-slate-600">${p.procedure}</td><td class="px-6 py-4 text-slate-500 text-xs">Hoje</td><td class="px-6 py-4 text-right"><i data-lucide="chevron-right" class="w-4 h-4 ml-auto text-slate-400"></i></td></tr>`;
            });
            lucide.createIcons();
        }

        function openPatientProfile(id) {
            const p = patientsDB.find(pat => pat.id == id);
            if(!p) return;
            document.getElementById('p-name').innerText = p.name;
            let parts = p.name.split(',');
            let initials = parts[0].trim().charAt(0) + (parts[1] ? parts[1].trim().charAt(0) : '');
            document.getElementById('p-avatar').innerText = initials;
            document.getElementById('p-status').innerText = p.status;
            
            const myTasks = tasksDB.filter(t => t.patientId == id);
            const widget = document.getElementById('p-tasks-widget');
            widget.innerHTML = '';
            if(myTasks.length > 0) {
                myTasks.forEach(t => widget.innerHTML += `<div class="flex items-center gap-2 p-2 bg-slate-50 rounded border border-slate-100"><div class="w-2 h-2 rounded-full bg-blue-500"></div><span class="text-sm text-slate-700">${t.title}</span></div>`);
            } else {
                widget.innerHTML = '<span class="text-xs text-slate-400 italic">Sem tarefas.</span>';
            }

            document.getElementById('patients-list-container').classList.add('hidden');
            document.getElementById('patient-detail-view').classList.remove('hidden');
        }

        function closePatientProfile() {
            document.getElementById('patient-detail-view').classList.add('hidden');
            document.getElementById('patients-list-container').classList.remove('hidden');
        }

        // TAREFAS & MODAIS
        function openTaskModal() { document.getElementById('task-modal').classList.remove('hidden'); }
        function openPatientModal() { document.getElementById('patient-modal').classList.remove('hidden'); }

        function addNewTaskMock() {
            const title = document.getElementById('new-task-title').value;
            const patientId = document.getElementById('new-task-patient').value;
            if(!title) return alert("T√≠tulo obrigat√≥rio!");
            tasksDB.push({ id: Date.now(), title, patientId, status: "todo" });
            renderKanbanBoard();
            document.getElementById('task-modal').classList.add('hidden');
        }

        async function createPatientDrive() {
            const nome = document.getElementById('input-nome').value;
            const sobrenome = document.getElementById('input-sobrenome').value;
            const cpf = document.getElementById('input-cpf').value;
            const btn = document.getElementById('btn-create-patient');
            if(!nome || !cpf) return alert("Preencha os dados!");
            
            const originalText = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Criando...`;
            
            try {
                // Use Fetch to call Robot
                if (ROBOT_URL_CREATE.includes("http")) {
                    const response = await fetch(ROBOT_URL_CREATE, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ nome, sobrenome, cpf })
                    });
                    if(response.ok) {
                        alert("Sucesso! Pasta criada no Drive.");
                        patientsDB.push({ id: Date.now(), name: `${sobrenome}, ${nome} - ${cpf}`, status: "Novo", procedure: "A definir" });
                        renderPatientsTable(); populatePatientSelects();
                        document.getElementById('patient-modal').classList.add('hidden');
                    } else { throw new Error("Erro no rob√¥"); }
                } else {
                     // Fallback visual se URL vazia
                    setTimeout(() => {
                        alert("Simula√ß√£o: Pasta criada (Configure a URL do Rob√¥).");
                        patientsDB.push({ id: Date.now(), name: `${sobrenome}, ${nome} - ${cpf}`, status: "Novo", procedure: "A definir" });
                        renderPatientsTable(); populatePatientSelects();
                        document.getElementById('patient-modal').classList.add('hidden');
                    }, 1000);
                }
            } catch(e) {
                console.error(e);
                alert("Erro ao conectar.");
            }
            btn.innerHTML = originalText;
        }

        function renderKanbanBoard() {
            ['col-todo', 'col-progress', 'col-done'].forEach(id => document.getElementById(id).innerHTML = '');
            tasksDB.forEach(task => {
                let colId = task.status === 'todo' ? 'col-todo' : task.status === 'progress' ? 'col-progress' : 'col-done';
                let pName = task.patientId ? patientsDB.find(p => p.id == task.patientId)?.name.split(',')[0] : null;
                let tag = pName ? `<div class="mt-2 text-[10px] text-blue-600 font-bold uppercase flex items-center gap-1"><i data-lucide="user" class="w-3 h-3"></i> ${pName}</div>` : '';
                document.getElementById(colId).innerHTML += `<div class="kanban-card bg-white p-3 rounded-lg border border-slate-200 shadow-sm mb-2 cursor-pointer"><p class="text-sm font-bold text-slate-800">${task.title}</p>${tag}</div>`;
            });
            lucide.createIcons();
        }
    </script>
</body>
</html>

